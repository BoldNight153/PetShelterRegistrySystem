# feat: stabilize site theme + polished ReDoc integration

This PR ships a production-ready setup for our test-frontend that keeps the UI on-brand and readable, with a robust theme system that ReDoc follows automatically.

## Why
- Theme would occasionally flip on navigation or during initial paint.
- ReDoc’s readability (right panel, code blocks, tables, tabs) and dropdown contrast needed work.
- ReDoc search wasn’t indexing when the spec was injected inline.

## What’s changed

### Theme stability and sync
- Add an early initialization script in `test-frontend/index.html` to set `html.dark` and `html[data-theme]` from `localStorage('theme')` or system preference before React mounts. This removes flash-of-incorrect-theme and ensures consistent theme across navigations.
- Remove the forced default dark mode from `test-frontend/src/main.tsx`; ThemeToggle is now the source of truth.
- Keep ThemeToggle emitting both a `data-theme` attribute and a `themechange` event so consumers (including ReDoc) update immediately.

### ReDoc integration
- ReDoc is hosted under `/docs` and now uses `specUrl` (`/api-docs/latest/openapi.json`) instead of an inline spec so its internal search index works.
- Curated hex-only themes aligned to our zinc palette for both light/dark modes.
- Scoped CSS improvements for readability:
  - Higher contrast headings/links
  - Right panel background and borders
  - Tables, tabs, and code blocks (syntax tokens, spacing)
  - Dropdowns and portal menus with better z-index/overflow handling (scoped via `body[data-redoc]`).

## Files changed
- `test-frontend/index.html`: Add early theme init to prevent flicker and ensure persistence.
- `test-frontend/src/main.tsx`: Remove forced `html.dark` class.
- `test-frontend/src/components/ui/theme-toggle.tsx`: Persist and broadcast theme; reflect in `html.dark` and `data-theme`.
- `test-frontend/src/docs/redoc-page.tsx`: Switch to `specUrl`, wire robust theme detection (localStorage, data-theme, class, matchMedia), and refine scoped styles.

## How it works
- Theme precedence: `localStorage('theme')` → system `prefers-color-scheme` → default to light. Applied at document start and kept in sync via ThemeToggle and a `themechange` CustomEvent.
- ReDoc reads the current theme and re-mounts on mode changes (light/dark) using a `key` tied to the active mode.
- Vite proxy provides the spec at `/api-docs/latest/openapi.json` so ReDoc can index and power the search UI.

## QA checklist
- Toggle theme and refresh; theme should persist with no flash.
- Navigate between Dashboard and Docs; theme should remain stable.
- In Docs:
  - Confirm search dropdown appears and results navigate correctly.
  - Check dropdowns (server URL, selects) render with proper contrast.
  - Verify code blocks and tables are readable in both themes.

## Risks and mitigations
- ReDoc bundle size is large by nature; it’s isolated to the `/docs` route and is lazy-loaded in the app.
- The early theme script is small and defensive; failures fall back to light without blocking render.

## Follow-ups (optional)
- Consider adding a keyboard shortcut to focus the ReDoc search input.
- Explore splitting vendor chunks further if needed for performance.

